#include <stdio.h>
#include <unistd.h>

/*
*
Notion sur setresuid
La fonction setresuid est une variante avancée de setuid, utilisée en programmation C pour gérer les permissions des processus sous Linux. Elle permet de modifier trois types d'UID associés à un processus :

Real UID (RUID) : Identifie l’utilisateur réel qui a lancé le processus.
Effective UID (EUID) : Détermine les permissions effectives utilisées pour accéder aux fichiers et exécuter des opérations privilégiées.
Saved UID (SUID) : Permet de restaurer un EUID précédent même après un changement d'UID.
*/ 

int main(int argc, char* argv[], char **envp){

    printf("GID=%d, RUID=%d, EUID=%d, SUID=%d\n",getgid() ,getuid(),geteuid(), getresuid() );

    if (setresuid(1001, 1002, 1003)==-1)
    {
        perror("Erreur setresuid");
        return 1;
    }
    printf("Valeurs après modification: RUID=%d, EUID=%d, SUID=%d\n", getuid(), geteuid(), getresuid());


     printf("Avant execl\n");

    // Exécute la commande "ls -l /"
    if (execl("/bin/ls", "ls", "-l", ".", (char *)NULL) == -1) {
        perror("Erreur execl");
    }

    printf("Cette ligne ne s'affichera pas si execl réussit !\n");
    

    return 0;
}